---
title: "CIS635-Project"
author: "Tyler Reed"
date: "4/19/2021"
output:
  github_document: default
  pdf_document: default
---

```{r setup, message=FALSE}
knitr::opts_chunk$set(error = TRUE, fig.width = 12, fig.asp = 0.618)
```

```{r load packages, import data, warning = FALSE, message = FALSE}

library(tidyverse)
library(knitr)
library(e1071)
library(rpart)
library(neuralnet)
library(hrbrthemes)
library(readr)
library(purrr)
library(ggthemes)

testA <- read.table("data/dataTestA.txt", header = TRUE)
testB <- read.table("data/dataTestB.txt", header = TRUE)
trainA <- read.table("data/dataTrainA.txt", header = TRUE)
trainB <- read.table("data/dataTrainB.txt", header = TRUE)
```


```{r preliminary analysis, A-train files, warning = FALSE, message = FALSE}

# PRELIMINARY ANALYSIS AND CLEANUP, NO GRAPHS, AND MERGE


trainA <- as_tibble(trainA)

# Calculate summary statistics and produce visuals to check for outliers/noise/NAs
trainA %>%
  summary() %>%
  kable()

# trainA  %>%
#   mutate(across(.cols = everything(), as_factor)) %>%
#   keep(is.numeric) %>% 
#   gather() %>% 
#   ggplot(aes(value)) +
#     facet_wrap(~ key, scales = "free") +
#     theme_tufte(base_size = 16) +
#     geom_histogram(color = "royalblue", bins = 500)

# Test for duplicate records
length(unique(trainA$id)) == nrow(trainA)

# Test for missing values by row
train_A_byrow<- rowSums(is.na(trainA))
max(train_A_byrow)

# Results

# No more than one NA per dataset

# id: looks good and no duplicates
# temp: 1 NA, and min and max troublesome, use average
# bbSys: 1 NA, and min and max troublesome, use average
# vo2: 2 NA, max troublesome
# throat: 1 NA, max troublesome
# atRisk: looks good

```


```{r preliminary analysis, B-train files, warning = FALSE, message = FALSE}

trainB <- as_tibble(trainB)

# Calculate summary statistics and produce visuals to check for outliers/noise/NAs
trainB %>%
  summary(trainB) %>%
  kable()
# 
# trainA %>%
#   mutate(across(.cols = everything(), as_factor)) %>%
#   select(-id) %>%
#   filter(temp > 106) %>%
#   ggplot(aes(x = temp)) +
#     geom_bar(fill = "royalblue", position = "dodge") +
#     scale_fill_brewer(palette = "Dark2") +
#     theme_tufte(base_size = 16) 
    


# Test for duplicate records
length(unique(trainB$id)) == nrow(trainB)

# Test for missing values by row
train_B_byrow <- rowSums(is.na(trainB))
max(train_B_byrow)

# Results

# id: looks good and no duplicates
# headA: 1 NA, max troublesome
# bodyA: looks good
# cough: looks good
# runny: 1 NA
# nausea: max is troublesome
# diarrhea: 1 NA
# atRisk: looks good

```

```{r cleanup outliers/missing data and merge, warning = FALSE, message = FALSE}

# Merge `trainA` and `trainB`
merged_train <- trainA %>%
  select(-atRisk) %>%
  left_join(trainB, by = "id")


# `trainA` Results

# id: looks good and no duplicates
# temp: 1 NA, and min and max troublesome, use average
# bbSys: 1 NA, and min and max troublesome, use average
# vo2: 2 NA, max troublesome
# throat: 1 NA, max troublesome
# atRisk: looks good

merged_train %>%
  # Convert `atRisk` to factor
  mutate(across(6:12, as_factor) %>%
  # mutate(across(2:11,
         # Convert NAs to mean value of variable
         `News Agency` = case_when(str_detect(`News Agency`, "CNN")
                                   ~ "CNN",
                                   TRUE ~ `News Agency`),
         attacktype1_txt = case_when(n <= 3 ~ "Other",
                                     TRUE ~ as.character(attacktype1_txt)))
# Create helper functions to define thresholds for vitals variables

temp_noise <- function(v) {
  for (i in 1:length(v)) {
    if (!(between(v[i], 90, 106))) {
      v[i] <- mean(v)
    }
  }
  v
}

bpSys_noise <- function(v) {
  for (i in 1:length(v)) {
    if (!(between(v[i], 90, 150))) {
      v[i] <- mean(v)
    }
  }
  v
}

vo2_noise <- function(v) {
  for (i in 1:length(v)) {
    if (!(between(v[i], 10, 70))) {
      v[i] <- mean(v)
    }
  }
  v
}

throat_noise <- function(v) {
  for (i in 1:length(v)) {
    if (!(between(v[i], 80, 120))) {
      v[i] <- mean(v)
    }
  }
  v
}

merged_train$ <- _noise(merged_train$temp)

getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}


clean_train <- function(trainA, trainB) {
  

  
  
  
  # Merge `trainA` and `trainB`
  merged_train <- trainA %>%
    select(-atRisk) %>%
    left_join(trainB, by = "id") %>%
    # Convert NAs of factor variables to mode 
    mutate(across(6:12, ~ replace_na(., getmode(.)))) %>%
    # Convert variables to respective types
    mutate(across(6:12, as_factor)) %>%
    mutate(across(2:5, as.numeric)) %>%
    # Convert NAs of numeric variables to mean 
    mutate(across(2:5, ~ replace_na(., mean(., na.rm = TRUE)))) 
  
  

    
  }
  
  
}



train_na <- is.na(merged_train)
sum(train_na)





```



```{r compare classifiers, warning = FALSE, message = FALSE}



```















